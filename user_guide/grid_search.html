

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Evaluating Grid Search Results &mdash; sklearn-evaluation 0.4 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="sklearn-evaluation 0.4 documentation" href="../index.html"/>
        <link rel="up" title="User Guide" href="../user_guide.html"/>
        <link rel="next" title="Advanced usage using matplotlib" href="matplotlib.html"/>
        <link rel="prev" title="Functional vs Object Oriented interface" href="func_vs_oop.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> sklearn-evaluation
          

          
          </a>

          
            
            
              <div class="version">
                0.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../user_guide.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="classifier.html">Classifier evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="report.html">Classifier evaluation using the OOP interface (report generation)</a></li>
<li class="toctree-l2"><a class="reference internal" href="func_vs_oop.html">Functional vs Object Oriented interface</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Evaluating Grid Search Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="matplotlib.html">Advanced usage using matplotlib</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">sklearn-evaluation</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../user_guide.html">User Guide</a> &raquo;</li>
      
    <li>Evaluating Grid Search Results</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/user_guide/grid_search.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="evaluating-grid-search-results">
<h1>Evaluating Grid Search Results<a class="headerlink" href="#evaluating-grid-search-results" title="Permalink to this headline">Â¶</a></h1>
<p>A common practice in Machine Learning is to train several models with different
hyperparameters and compare the performance across hyperparameter sets.
scikit-learn provides a tool to do it: <a class="reference external" href="http://scikit-learn.org/stable/modules/generated/sklearn.grid_search.GridSearchCV.html#sklearn.grid_search.GridSearchCV" title="(in scikit-learn v0.18.1)"><code class="xref py py-class docutils literal"><span class="pre">sklearn.grid_search.GridSearchCV</span></code></a>, which trains the same model
with different parameters. When doing grid search, it is tempting to just take
the &#8216;best model&#8217; and carry on, but analizing the results can give us some
interesting information, so it&#8217;s worth taking a look at the results.</p>
<p>sklearn-evaluation includes a plotting function to evaluate grid search results, this way we can see how the model performs when changing one (or two)
hyperparameter(s) by keeping the rest constant.</p>
<p>First, let&#8217;s load some data.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="n">data</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">make_classification</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="gp">   ...: </span>                                    <span class="n">n_informative</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">class_sep</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="gp">   ...: </span>

<span class="gp">In [2]: </span><span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="gp">In [3]: </span><span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>Now, we need to define which hyperparameter sets we wan to include in the
grid search, we do so by defining a dictionary with hyperparameter-values pairs
and scikit-learn will automatically generate all possible combinations. For the
dictionary below, we can generate 16 combinations (4*2*2).</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [4]: </span><span class="n">hyperparameters</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">   ...: </span>    <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
<span class="gp">   ...: </span>    <span class="s1">&#39;criterion&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;gini&#39;</span><span class="p">,</span> <span class="s1">&#39;entropy&#39;</span><span class="p">],</span>
<span class="gp">   ...: </span>    <span class="s1">&#39;max_features&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="s1">&#39;log2&#39;</span><span class="p">],</span>
<span class="gp">   ...: </span><span class="p">}</span>
<span class="gp">   ...: </span>
</pre></div>
</div>
<p>To perform a grid search we first need to select an estimator, in this case
a Random Forest, then use the GridSearchCV class to pass the estimator, the
hypeparameter dictionary and the number of folds for cross-validation.</p>
<p>After fitting the models (note that we call fit on the GridSearchCV instead of
the estimator itself) we can get the results using the <code class="xref py py-attr docutils literal"><span class="pre">sklearn.grid_search.GridSearchCV.grid_scores_</span></code> attribute.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [5]: </span><span class="n">est</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">()</span>

<span class="gp">In [6]: </span><span class="n">clf</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">est</span><span class="p">,</span> <span class="n">hyperparameters</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="gp">In [7]: </span><span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="go"> Out[7]: </span>
<span class="go">GridSearchCV(cv=3, error_score=&#39;raise&#39;,</span>
<span class="go">       estimator=RandomForestClassifier(bootstrap=True, class_weight=None, criterion=&#39;gini&#39;,</span>
<span class="go">            max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,</span>
<span class="go">            min_samples_leaf=1, min_samples_split=2,</span>
<span class="go">            min_weight_fraction_leaf=0.0, n_estimators=10, n_jobs=1,</span>
<span class="go">            oob_score=False, random_state=None, verbose=0,</span>
<span class="go">            warm_start=False),</span>
<span class="go">       fit_params={}, iid=True, n_jobs=1,</span>
<span class="go">       param_grid={&#39;n_estimators&#39;: [1, 10, 50, 100], &#39;max_features&#39;: [&#39;sqrt&#39;, &#39;log2&#39;], &#39;criterion&#39;: [&#39;gini&#39;, &#39;entropy&#39;]},</span>
<span class="go">       pre_dispatch=&#39;2*n_jobs&#39;, refit=True, scoring=None, verbose=0)</span>

<span class="gp">In [8]: </span><span class="n">grid_scores</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">grid_scores_</span>
</pre></div>
</div>
<p>To generate the plot, we need to pass the grid_scores and the parameter(s) to
change, let&#8217;s see how the number of trees in the Random Forest affects
the performance of the model.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [9]: </span><span class="n">plot</span><span class="o">.</span><span class="n">grid_search</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="n">grid_scores_</span><span class="p">,</span> <span class="n">change</span><span class="o">=</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
<span class="go"> Out[9]: &lt;matplotlib.axes._subplots.AxesSubplot at 0x2b3c314be710&gt;</span>
</pre></div>
</div>
<img alt="../_images/gs_1.png" src="../_images/gs_1.png" />
<p>We can also subset the grid scores to plot by using the subset parameter (note
that the hyperparameter in change can also appear in subset).</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [10]: </span><span class="n">plot</span><span class="o">.</span><span class="n">grid_search</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="n">grid_scores_</span><span class="p">,</span> <span class="n">change</span><span class="o">=</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">,</span>
<span class="gp">   ....: </span>                 <span class="n">subset</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
<span class="gp">   ....: </span>                         <span class="s1">&#39;criterion&#39;</span><span class="p">:</span> <span class="s1">&#39;gini&#39;</span><span class="p">},</span>
<span class="gp">   ....: </span>                 <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
<span class="gp">   ....: </span>
<span class="gh">Out[10]: </span><span class="go">&lt;matplotlib.axes._subplots.AxesSubplot at 0x2b3c31beed90&gt;</span>
</pre></div>
</div>
<img alt="../_images/gs_2.png" src="../_images/gs_2.png" />
<p>To evaluate the effect of two hyperparameters, we pass the two of them in
change, note that for this to work we need to subset the grid scores to match
only one group. In this case we&#8217;ll plot n_estimators and criterion, so we need
to subset max_features to one single value.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [11]: </span><span class="n">plot</span><span class="o">.</span><span class="n">grid_search</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="n">grid_scores_</span><span class="p">,</span> <span class="n">change</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">,</span> <span class="s1">&#39;criterion&#39;</span><span class="p">),</span>
<span class="gp">   ....: </span>                 <span class="n">subset</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;max_features&#39;</span><span class="p">:</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">})</span>
<span class="gp">   ....: </span>
<span class="gh">Out[11]: </span><span class="go">&lt;matplotlib.axes._subplots.AxesSubplot at 0x2b3c3138a1d0&gt;</span>
</pre></div>
</div>
<img alt="../_images/gs_3.png" src="../_images/gs_3.png" />
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="matplotlib.html" class="btn btn-neutral float-right" title="Advanced usage using matplotlib" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="func_vs_oop.html" class="btn btn-neutral" title="Functional vs Object Oriented interface" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Eduardo Blancas Reyes.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.4',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>